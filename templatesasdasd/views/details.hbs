<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>ScaleEdge</title>
  <link rel="stylesheet" href="/assets/vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="/assets/vendors/css/vendor.bundle.base.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://kit.fontawesome.com/yourcode.js" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/sweetalert/dist/sweetalert.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/javascripts/usermanagment.js"></script>
  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="shortcut icon" href="/assets/images/favicon.ico" />
</head>

<body>
  <div class="container-scroller">
    {{>topbar}}
    <div class="container-fluid page-body-wrapper">
      {{>sidebar}}
      <div class="main-panel">
        <div class="content-wrapper">
          <div class="page-header">
            <h3 class="page-title">
              <span class="page-title-icon bg-gradient-primary text-white me-2">
                <i class="mdi mdi-home"></i>
              </span> Attendance Report User
            </h3>

          </div>

          <div class="row">
            <div class="row flex-column-reverse flex-lg-row">
              <div class="col-lg-6 grid-margin stretch-card">
                <div class="card">
                  <div class="card-body">
                    <div class="calendarBox">
                      <label for="calendarInput">Select Month and Year:</label>
                      <input type="month" id="calendarInput" onchange="filterData()" />
                    </div>
                    <div class="table-container" style="height: 400px; overflow-y: scroll;">
                      <table id="userDataTable" class="table table-hover">
                        <thead>
                          <tr>
                            <th scope="col">Name</th>
                            <th scope="col">Date</th>
                            <th scope="col">Time</th>
                            <th scope="col">Type</th>
                            <th scope="col">Status</th>
                            <th scope="col">Mark</th>
                          </tr>
                        </thead>
                        <tbody id="userTableBody">
                          {{#each rows}}
                          <tr>
                            <td scope="row">{{this.user_name}}</td>
                            <td>{{this.date_column}}</td>
                            <td>{{this.time_column}}</td>
                            <td>{{this.A_type}}</td>
                            <td>{{this.range_status}}</td>
                            <td>{{this.attendance_mark}}</td>
                          </tr>
                          {{/each}}
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-lg-6 grid-margin stretch-card">
                <div class="card">
                  <div class="card-body">
                    <div class="image-container">
                      <div class="round-circle">
                        <img src="/profile/{{rows.0.Imagepath}}" alt="User Image">
                      </div>
                      <p class="image-name">{{rows.0.user_name}}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <script src="/assets/vendors/js/vendor.bundle.base.js"></script>
    <script src="/assets/vendors/chart.js/Chart.min.js"></script>
    <script src="/assets/js/jquery.cookie.js" type="text/javascript"></script>
    <script src="/assets/js/off-canvas.js"></script>
    <script src="/assets/js/hoverable-collapse.js"></script>
    <script src="/assets/js/misc.js"></script>
    <script src="/assets/js/dashboard.js"></script>
    <script src="/assets/js/todolist.js"></script>
</body>

</html>
<style>
  .image-container {
    text-align: center;
    padding: 20px;
  }

  .round-circle {
    width: 100px;
    height: 100px;
    background-color: #e0e0e0;
    border-radius: 50%;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
  }

  .round-circle img {
    max-width: 100%;
    border-radius: 50%;
    margin-top: 33px;

  }

  .image-name {
    margin-top: 10px;

  }

  .table thead th {
    position: sticky;
    top: 0;
    background-color: #fff;
    z-index: 2;
  }

  .table-wrapper {
    max-height: 500px;
    overflow-y: auto;
  }

  .calendarBox {
    margin-bottom: 20px;
  }

  #calendarInput {
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
</style>
<script>
  function sortTable() {
    const table = document.getElementById("userTableBody");
    const rows = Array.from(table.querySelectorAll("tr"));

    rows.sort((a, b) => {
      const dateA = new Date(a.querySelector("td:nth-child(2)").textContent);
      const dateB = new Date(b.querySelector("td:nth-child(2)").textContent);
      return dateA - dateB;
    });

    rows.forEach(row => table.appendChild(row));
  }

  function filterData() {
    const selectedDate = new Date(document.getElementById("calendarInput").value);
    const currentDate = new Date();
    const selectedYear = selectedDate.getFullYear();
    const selectedMonth = selectedDate.getMonth() + 1;

    const rows = document.querySelectorAll("#userTableBody tr");
    const existingDates = new Set();

    rows.forEach(row => {
      const rowDate = new Date(row.querySelector("td:nth-child(2)").textContent);
      const rowYear = rowDate.getFullYear();
      const rowMonth = rowDate.getMonth() + 1;

      if (rowYear === selectedYear && rowMonth === selectedMonth && rowDate <= currentDate) {
        row.style.display = "table-row";
        existingDates.add(rowDate.getDate());
      } else {
        row.style.display = "none";
      }
    });

    const daysInMonth = new Date(selectedYear, selectedMonth, 0).getDate();
    const tableBody = document.getElementById("userTableBody");
    const userName = document.querySelector("#userTableBody tr:first-child td:first-child").textContent;

    for (let day = 1; day <= daysInMonth; day++) {
      if (!existingDates.has(day)) {
        const newDate = new Date(selectedYear, selectedMonth - 1, day);
        if (newDate <= currentDate) {
          const newRow = document.createElement("tr");
          newRow.innerHTML = `
            <td>${userName}</td>
            <td>${selectedYear}-${selectedMonth.toString().padStart(2, "0")}-${day.toString().padStart(2, "0")}</td>
            <td>--</td>
            <td>--</td>
            <td>--</td>
            <td>Absent</td>
          `;
          newRow.classList.add("missing-date");
          tableBody.appendChild(newRow);
        }
      }
    }

    sortTable();
  }

  function setCurrentMonthYear() {
    const currentDate = new Date();
    const year = currentDate.getFullYear();
    let month = currentDate.getMonth() + 1;
    if (month < 10) {
      month = "0" + month;
    }
    const defaultDate = `${year}-${month}`;
    document.getElementById("calendarInput").value = defaultDate;

    filterData();
  }

  setCurrentMonthYear();
</script>
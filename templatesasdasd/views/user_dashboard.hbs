<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>ScaleEdge</title>
  <link rel="stylesheet" href="assets/vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="assets/vendors/css/vendor.bundle.base.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://kit.fontawesome.com/yourcode.js" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/sweetalert/dist/sweetalert.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/javascripts/usermanagment.js"></script>
  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/css/cal.css">
  <link rel="stylesheet" href="assets/css/userdashboard.css">
  <link rel="shortcut icon" href="assets/images/favicon.ico" />
  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
  <meta name="viewport" content=" width=" 1024", initial-scale=1, user-scalable=yes">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
</head>

<body>
  <div class="container-scroller">
    {{>topbar}}
    <div class="container-fluid page-body-wrapper">
      {{>attendanceSidebar}}
      <div class="main-panel">
        <div class="content-wrapper">
          <div class="page-header">
            <h3 class="page-title">
              <span class="page-title-icon bg-gradient-primary text-white me-2">
                <i class="mdi mdi-home"></i>
              </span> Dashboard
            </h3>
          </div>

          <div class="row">
            {{!-- Birthday Card & Quotes Card --}}
            <div class="col-md-7 grid-margin stretch-card">
              <div class="card"
                style="box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); border-radius: 10px;{{#if isBirthday}} background-image: url(./images/a.webp); {{/if}}">
                <div class="card-body">
                  <div class="clearfix">
                    <div>
                      <h4 class="card-title" id="greeting"
                        style="color: #3498db; font-family: 'Helvetica Neue', sans-serif; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 10px; font-weight: 800;">
                        {{#if isBirthday}}
                        Happy Birthday, {{user_name}}!
                        {{else}}
                        Hello, {{user_name}}!
                        {{/if}}
                      </h4>
                      {{#if isBirthday}}
                      <p class="lead" id="quote-text1">
                        ðŸŽ‰ May your day be filled with joy, success, and all the wonderful moments that make life truly
                        special. ðŸŒŸ Wishing you another year of amazing achievements and growth. ðŸš€ Cheers to you and
                        the fantastic journey ahead! ðŸ¥³
                      </p>
                      <hr style="height: 2px;">
                      <div class="d-flex justify-content-between">
                        <p class="mb-0" id="quote-author1">ScaleEdge Team</p>
                        <h6 class="mb-0">
                          <span class="badge rounded-pill" style="background-color: rgba(0,0,0, 0.2);"></span>
                          <i class="fas fa-heart ms-2 text-red" style="color: red;"></i>
                        </h6>
                      </div>
                      {{else}}
                      <i class="fas fa-quote-left fa-2x mb-4"></i>
                      <p class="lead" id="quote-text"></p>
                      <hr style="height: 2px;">
                      <div class="d-flex justify-content-between">
                        <p class="mb-0" id="quote-author"></p>
                        <h6 class="mb-0"><span class="badge rounded-pill"
                            style="background-color: rgba(0,0,0, 0.2);"></span> <i class="fas fa-heart ms-2 text-red"
                            style="color: red;"></i></h6>
                      </div>
                      {{/if}}
                    </div>
                  </div>
                </div>
              </div>

            </div>
            {{!-- notifications --}}
            <div class="col-md-5 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title">ðŸŽ‰ Notifications</h4>
                  <ul class="icon-data-list">
                    {{#if isBirthday}}
                    {{!-- <!-- Display birthday notification for a single user -->
                    <li class="mb-3">
                      <div class="d-flex align-items-center mb-3" style="gap: 20px;">
                        <img src="/profile/{{image_path}}" alt="{{user_name}}"
                          class="birthday-image rounded-circle mr-3" style="width: 64px; height: 64px;">
                        <div>
                          <p class="text-info mb-1">Happy Birthday, {{user_name}}!</p>
                          <p class="mb-0">Wishing you a fantastic day!</p>
                          <small class="text-muted">{{formatTimeForNotification}}</small>
                        </div>
                      </div>
                    </li> --}}
                    {{else}}
                    <!-- Display attractive message when there are no notifications -->
                    <li class="mb-3">
                      <div class="text-center">
                        <p class="text-muted" style="font-size: 18px; color: #888; margin-top:11vh">No notifications to display.
                          Enjoy your day!</p>
                      </div>
                    </li>
                    {{/if}}

                    {{#each birthdayUsers}}
                    <!-- Display birthday notifications for multiple users -->
                    <li class="mb-3">
                      <div class="d-flex align-items-center mb-3" style="gap: 20px;">
                        <img src="/profile/{{this.image_path}}" alt="{{this.user_name}}"
                          class="birthday-image rounded-circle mr-3" style="width: 64px; height: 64px;">
                        <div>
                          <p class="text-info mb-1">Happy Birthday, {{this.user_name}}!</p>
                          <p class="mb-0">Wishing you a fantastic day!</p>
                          <small class="text-muted">{{formatTimeForNotification}}</small>
                        </div>
                      </div>
                    </li>
                    {{/each}}
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            {{!-- Attendance Report --}}
            <div class="col-md-6 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title">Attendance Report</h4>
                  <div class="col-md-12">
                    <div class="d-flex justify-content-center " style="gap: 20px;">
                      <h6>ðŸŸ¢Present</h6>
                      <h6>ðŸ”´Absent</h6>
                      <h6>ðŸŸ£Halfday</h6>
                      <h6>ðŸŸ¡Leave</h6>
                    </div>
                    <div class="wrapper-attendance">
                      <header>
                        <p class="current-date-attendance"
                          style="padding: 0 10px;font-weight: 600;font-size: 20px;color: #1089ff;float: left;width: 70%;margin: 0 0 10px;">
                        </p>
                        <div class="icons-attendance">
                          <span id="prev-attendance" class="material-symbols-rounded">chevron_left</span>
                          <span id="next-attendance" class="material-symbols-rounded">chevron_right</span>
                        </div>
                      </header>
                      <div class="calendar-attendance">
                        <ul class="weeks-attendance" style="background: #1089ff;max-width: 450px;padding: 10px;">
                          <li style="color: white;">Sun</li>
                          <li style="color: white;">Mon</li>
                          <li style="color: white;">Tue</li>
                          <li style="color: white;">Wed</li>
                          <li style="color: white;">Thu</li>
                          <li style="color: white;">Fri</li>
                          <li style="color: white;">Sat</li>
                        </ul>
                        <ul class="days-attendance"></ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {{!-- Upcoming Holidays --}}
            <div class="col-md-6 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title">Upcoming Holidays</h4>
                  <div class="col-md-12 d-flex">
                    <div class="col-md-10 mt-4">
                      <div class="wrapper">
                        <header>
                          <p class="current-date"
                            style="padding: 0 10px;font-weight: 600;font-size: 20px;color: #1089ff;float: left;width: 70%;margin: 0 0 10px;">
                          </p>
                          <div class="icons">
                            <span id="prev" class="material-symbols-rounded">chevron_left</span>
                            <span id="next" class="material-symbols-rounded">chevron_right</span>
                          </div>
                        </header>
                        <div class="calendar">
                          <ul class="weeks" style="background: #1089ff;max-width: 450px;padding: 10px;">
                            <li style="color: white;">Sun</li>
                            <li style="color: white;">Mon</li>
                            <li style="color: white;">Tue</li>
                            <li style="color: white;">Wed</li>
                            <li style="color: white;">Thu</li>
                            <li style="color: white;">Fri</li>
                            <li style="color: white;">Sat</li>
                          </ul>
                          <ul class="days"></ul>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-2 mt-5 align-item-center" style="gap: 20px;">
                      <ul class="icon-data-list">
                        {{#each upcomingHolidays}}
                        <li>
                          <div class="mb-2">
                            <small>{{formatDateToMySQLDate this.date}}</small>
                            <p class="mb-0">{{this.remarks}}</p>
                          </div>
                        </li>
                        {{/each}}
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
          </div>

          <div class="row">
           {{!-- attendance card checkin checkout --}}
            <div class="col-md-5 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title text-center">Attendance Record</h4>
                  <div class="d-flex justify-content-around text-center mt-5 mb-2">
                    <div class="record-box">
                      <p class="text-muted mb-0">In</p>
                      <p class="mb-2 h5" id="firstInRecord">{{firstInRecord}}</p>
                    </div>
                    <div class="record-box">
                      <p class="text-muted mb-0">Out</p>
                      <p class="mb-2 h5" id="firstOutRecord">{{firstOutRecord}}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {{!-- documents card --}}
            <div class="col-md-5 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title">My Documents</h4>
                  <div class="table-responsive">
                    <table class="table">
                      <thead>
                        <tr>
                          <th> Documents </th>
                          <th> View </th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td> Adhar Card </td>
                          <td>
                            <p id="userAdhar"><img src="/icons/eye.png" alt="" srcset=""></p>
                          </td>

                        </tr>
                        <tr>
                          <td> Pan Card </td>
                          <td>
                            <p id="userPancard"><img src="/icons/eye.png" alt="" srcset=""></p>
                          </td>

                        </tr>

                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row justify-content-center">
            {{!-- Leave Requests --}}
            <div class="col-md-4 stretch-card grid-margin" style="z-index: 1;">
              <div class="card bg-gradient-success card-img-holder text-white" style="height: 106px;">
                <div class="card-body">
                  <img src="assets/images/dashboard/circle.svg" class="card-img-absolute" alt="circle-image">
                  <h4 class="font-weight-normal mb-3" style="/* margin-block: -15px; */margin-top: -19px;">Leave
                    Requests <i class="mdi mdi-calendar-edit menu-icon mdi-24px float-right"></i>
                  </h4>
                  <h2 class="mb-2"> </h2>
                  <a href="/leaveTableuser" style="text-decoration: none; color:black;font-size: 20px;"
                    class="card-text">View All
                  </a><i class="mdi mdi-arrow-right-bold-circle " style="color: black;"></i>
                </div>
              </div>
            </div>
            {{!-- Attendance Requests --}}
            <div class="col-md-4 stretch-card grid-margin" style="z-index: 1;">
              <div class="card bg-gradient-primary card-img-holder text-white" style="height: 106px;">
                <div class="card-body">
                  <img src="assets/images/dashboard/circle.svg" class="card-img-absolute" alt="circle-image">
                  <h4 class="font-weight-normal mb-3" style="/* margin-block: -15px; */margin-top: -19px;">
                    Requests <i class="mdi mdi-calendar-edit menu-icon mdi-24px float-right"></i>
                  </h4>
                  <h2 class="mb-2"> </h2>
                  <a href="/userManualUpdate" style="text-decoration: none; color:black;font-size: 20px;"
                    class="card-text">View All
                  </a><i class="mdi mdi-arrow-right-bold-circle " style="color: black;"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="assets/vendors/js/vendor.bundle.base.js"></script>
    <script src="assets/vendors/chart.js/Chart.min.js"></script>
    <script src="assets/js/jquery.cookie.js" type="text/javascript"></script>
    <script src="assets/js/off-canvas.js"></script>
    <script src="assets/js/hoverable-collapse.js"></script>
    <script src="assets/js/misc.js"></script>
    <script src="assets/js/dashboard.js"></script>
    <script src="assets/js/todolist.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>

</html>

{{!-- greetings.js --}}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var greetingElement = document.getElementById('greeting');
    var currentTime = new Date().getHours();

    var isBirthday = {{ isBirthday }};

  if (isBirthday) {
    greetingElement.textContent = 'Happy Birthday, {{user_name}}!';
  } else {
    if (currentTime >= 9 && currentTime < 11) {
      greetingElement.textContent = 'Good morning, {{user_name}}!';
    } else if (currentTime >= 11 && currentTime < 16) {
      greetingElement.textContent = 'Good afternoon, {{user_name}}!';
    } else {
      greetingElement.textContent = 'Good evening, {{user_name}}!';
    }
  }
  });
</script>

{{!-- quotes.json --}}
<script>
  function fetchAndDisplayQuote() {
    fetch('quotes.json')
      .then((response) => response.json())
      .then((data) => {
        const quotes = data.quotes;
        const quoteText = document.getElementById('quote-text');
        const quoteAuthor = document.getElementById('quote-author');

        const currentDate = new Date();
        const dayOfYear = Math.floor((Date.UTC(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate()) - Date.UTC(currentDate.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
        const index = dayOfYear % quotes.length;

        const quote = quotes[index];
        quoteText.textContent = quote.quote;
        quoteAuthor.textContent = quote.author;
      })
      .catch((error) => {
        console.error('Error fetching quotes:', error);
      });
  }

  fetchAndDisplayQuote();
</script>

{{!-- attendance checkin checkout record --}}
<script>
  // Assuming firstInRecord and firstOutRecord are in the format 'HH:mm'
  var checkInTime = "{{firstInRecord}}";
  var checkOutTime = "{{firstOutRecord}}";

  // Splitting the time strings into hours and minutes
  var checkInTimeArray = checkInTime.split(":");
  var checkOutTimeArray = checkOutTime.split(":");

  // Creating a Chart.js chart
  var ctx = document.getElementById('attendanceChart').getContext('2d');
  var attendanceChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['Check-in', 'Check-out'],
      datasets: [{
        label: 'Time',
        data: [parseInt(checkInTimeArray[0]), parseInt(checkOutTimeArray[0])],
        backgroundColor: ['rgba(255, 99, 132, 0.5)', 'rgba(54, 162, 235, 0.5)'],
        borderColor: ['rgba(255, 99, 132, 1)', 'rgba(54, 162, 235, 1)'],
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>

{{!-- attendance calendar --}}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Get the current date
    const currentDate = new Date();

    // Function to generate calendar
    function generateCalendar(year, month) {
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const firstDay = new Date(year, month, 1).getDay();

      const weeks = document.querySelector('.weeks-attendance');
      const daysList = document.querySelector('.days-attendance');
      daysList.innerHTML = '';

      // Set the current date header
      document.querySelector('.current-date-attendance').textContent = `${new Intl.DateTimeFormat('en-US', { month: 'long' }).format(currentDate)} ${currentDate.getFullYear()}`;

      // Generate days
      for (let i = 0; i < firstDay; i++) {
        const emptyDay = document.createElement('li');
        emptyDay.textContent = '';
        daysList.appendChild(emptyDay);
      }

      for (let i = 1; i <= daysInMonth; i++) {
        const day = document.createElement('li');
        day.textContent = i;

        // Highlight the current date
        if (i === currentDate.getDate() && month === currentDate.getMonth() && year === currentDate.getFullYear()) {
          day.classList.add('active-date');
        }

        daysList.appendChild(day);
      }
    }

    // Initial calendar generation
    generateCalendar(currentDate.getFullYear(), currentDate.getMonth());

    // Event listeners for changing the month
    document.getElementById('prev-attendance').addEventListener('click', function () {
      currentDate.setMonth(currentDate.getMonth() - 1);
      generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
    });

    document.getElementById('next-attendance').addEventListener('click', function () {
      currentDate.setMonth(currentDate.getMonth() + 1);
      generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
    });
  });
</script>

{{!-- adhar card --}}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var userAdhar = localStorage.getItem("userAdhar");

    var userAdharSpan = document.getElementById("userAdhar");
    userAdharSpan.innerHTML = '<img src="/icons/eye.png" alt="" srcset="">';

    userAdharSpan.addEventListener('click', function () {
      var filePath = "/document/" + userAdhar;

      var downloadLink = document.createElement('a');

      downloadLink.download = userAdhar;
      downloadLink.href = filePath;

      document.body.appendChild(downloadLink);

      downloadLink.click();

      document.body.removeChild(downloadLink);
    });
  });
</script>

{{!-- pancard --}}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var userPancard = localStorage.getItem("userPancard");

    var userPancardSpan = document.getElementById("userPancard");
    userPancardSpan.innerHTML = '<img src="/icons/eye.png" alt="" srcset="">';

    userPancardSpan.addEventListener('click', function () {
      var filePath = "/document/" + userPancard;

      var downloadLink = document.createElement('a');

      downloadLink.download = userPancard;
      downloadLink.href = filePath;

      document.body.appendChild(downloadLink);

      downloadLink.click();

      document.body.removeChild(downloadLink);
    });
  });
</script>

{{!-- upcoming holidays logic --}}
<script>
  const daysTag = document.querySelector(".days"),
    currentDate = document.querySelector(".current-date"),
    prevNextIcon = document.querySelectorAll(".icons span");

  let date = new Date(),
    currYear = date.getFullYear(),
    currMonth = date.getMonth();

  const months = ["January", "February", "March", "April", "May", "June", "July",
    "August", "September", "October", "November", "December"
  ];

  // Modify this code to dynamically extract upcoming holidays data from the HTML
  const upcomingHolidays = [];

  document.querySelectorAll(".icon-data-list li").forEach(item => {
    const dateElement = item.querySelector("small");
    const remarksElement = item.querySelector("p");

    if (dateElement && remarksElement) {
      upcomingHolidays.push({
        date: dateElement.innerText.trim(),
        remarks: remarksElement.innerText.trim()
      });
    }
  });

  const renderCalendar = () => {
    let firstDayofMonthAttendance = new Date(currYear, currMonth, 1).getDay(),
      lastDateofMonth = new Date(currYear, currMonth + 1, 0).getDate(),
      lastDayofMonth = new Date(currYear, currMonth, lastDateofMonth).getDay(),
      lastDateofLastMonth = new Date(currYear, currMonth, 0).getDate();
    let liTag = "";

    for (let i = firstDayofMonthAttendance; i > 0; i--) {
      liTag += `<li class="inactive">${lastDateofLastMonth - i + 1}</li>`;
    }

    for (let i = 1; i <= lastDateofMonth; i++) {
      let isToday = i === date.getDate() && currMonth === new Date().getMonth() && currYear === new Date().getFullYear() ? "active" : "";

      // Check if the current date is an upcoming holiday
      let holidayDate = new Date(currYear, currMonth, i);
      let isHoliday = upcomingHolidays.some(holiday => {
        let holidayDateObj = new Date(holiday.date);
        return (
          holidayDateObj.getFullYear() === holidayDate.getFullYear() &&
          holidayDateObj.getMonth() === holidayDate.getMonth() &&
          holidayDateObj.getDate() === holidayDate.getDate()
        );
      });

      // Apply different classes based on whether it's today or an upcoming holiday
      if (isToday) {
        liTag += `<li class="${isToday}">${i}</li>`;
      } else if (isHoliday) {
        liTag += `<li class="upcoming-holiday">${i}</li>`;
      } else {
        liTag += `<li>${i}</li>`;
      }
    }

    for (let i = lastDayofMonth; i < 6; i++) {
      liTag += `<li class="inactive">${i - lastDayofMonth + 1}</li>`;
    }
    currentDate.innerText = `${months[currMonth]} ${currYear}`;
    daysTag.innerHTML = liTag;
  };

  renderCalendar();

  prevNextIcon.forEach(icon => {
    icon.addEventListener("click", () => {
      currMonth = icon.id === "prev" ? currMonth - 1 : currMonth + 1;

      if (currMonth < 0 || currMonth > 11) {
        date = new Date(currYear, currMonth);
        currYear = date.getFullYear();
        currMonth = date.getMonth();
      } else {
        date = new Date();
      }
      renderCalendar();
    });
  });
</script>
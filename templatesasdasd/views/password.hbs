<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.2/mdb.min.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <!-- Add this in your HTML head -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10">

    <!-- ... Your existing HTML ... -->

    <style>
        .success-toast {
            background-color: lightgreen;
            color: black;
            animation: toastAnimation 2s ease-in-out;
        }

        .error-toast {
            background-color: lightcoral;
            animation: toastAnimation 2s ease-in-out;
        }

        @keyframes toastAnimation {
            0% {
                opacity: 0;
                transform: translateY(100%);
            }

            20% {
                opacity: 1;
                transform: translateY(0);
            }

            80% {
                opacity: 1;
                transform: translateY(0);
            }

            100% {
                opacity: 0;
                transform: translateY(100%);
            }
        }
    </style>
</head>

<body>
    <section class="background-radial-gradient overflow-hidden">
        <style>
            {
                    {
                    !-- .background-radial-gradient {
                        background-color: hsl(218, 41%, 15%);
                        background-image: radial-gradient(650px circle at 0% 0%,
                                hsl(218, 41%, 35%) 15%,
                                hsl(218, 41%, 30%) 35%,
                                hsl(218, 41%, 20%) 75%,
                                hsl(218, 41%, 19%) 80%,
                                transparent 100%),
                            radial-gradient(1250px circle at 100% 100%,
                                hsl(218, 41%, 45%) 15%,
                                hsl(218, 41%, 30%) 35%,
                                hsl(218, 41%, 20%) 75%,
                                hsl(218, 41%, 19%) 80%,
                                transparent 100%);
                    }

                    --
                }
            }

            #radius-shape-1 {
                height: 220px;
                width: 220px;
                top: -60px;
                left: -130px;
                background: radial-gradient(#44006b, #ad1fff);
                overflow: hidden;
            }

            #radius-shape-2 {
                border-radius: 38% 62% 63% 37% / 70% 33% 67% 30%;
                bottom: -60px;
                right: -110px;
                width: 300px;
                height: 300px;
                background: radial-gradient(#44006b, #ad1fff);
                overflow: hidden;
            }

            .bg-glass {
                background-color: hsla(0, 0%, 100%, 0.9) !important;
                backdrop-filter: saturate(200%) blur(25px);
            }

            @media (max-width: 767px) {

                .background-radial-gradient {
                    overflow-x: hidden;
                    overflow-y: auto;
                }

                .reverse-order {
                    flex-direction: column-reverse;
                }
            }
        </style>
        <div class="container px-4 px-md-5 text-center text-lg-start my-5">
            <div class="row gx-lg-5 align-items-center mb-5 reverse-order" style="margin-top: 171px;">
                <div class="col-lg-6 mb-5 mb-lg-0" style="z-index: 10">
                    <h1 class="my-5 display-5 fw-bold ls-tight" style="color: hsl(218, 81%, 35%)">
                        ScaleEdge Solution <br>
                        <span style="color: hsl(218, 81%, 75%)">IT Services Provider</span>
                    </h1>
                    <p class="mb-4 opacity-70" style="color: hsl(218, 81%, 25%)">
                        We specialize in IT services and offer a state-of-the-art Face Attendance System for businesses.
                        Our solution ensures accurate and efficient attendance tracking using facial recognition
                        technology.
                        Contact us to learn more about how we can help your business streamline attendance management.
                    </p>
                </div>

                <div class="col-lg-6 mb-5 mb-lg-0 position-relative">
                    <div id="radius-shape-1" class="position-absolute rounded-circle shadow-5-strong"></div>
                    <div id="radius-shape-2" class="position-absolute shadow-5-strong"></div>

                    <div class="card bg-glass">
                        <div style="display: flex; justify-content: center; align-items: center;">
                            <img src="/images/logo.png" class="mx-5" alt="" style="height: 30vh; width: 35vh;">
                        </div>
                        <div class="card-body px-4 py-0 mb-0  px-md-5" style="/* margin-top: 41px; */">
                            <form class="sign-in-form" method="post" action="/update_password">
                                <input hidden name="email" value="{{email}}">

                                <div class="form-outline mb-4">
                                    <input style="padding: 0.65rem 0.75rem;" type="password" id="password"
                                        name="password" class="form-control">
                                    <label class="form-label" for="form3Example3" style="margin-left: 0px;">New
                                        Password</label>
                                    <div class="form-notch">
                                        <div class="form-notch-leading" style="width: 9px;"></div>
                                        <div class="form-notch-middle" style="width: 88.8px;"></div>
                                        <div class="form-notch-trailing"></div>
                                    </div>
                                </div>
                                <div class="form-outline mb-4">
                                    <input style="padding: 0.65rem 0.75rem;" type="password" id="cpassword"
                                        name="cpassword" class="form-control">
                                    <label class="form-label" for="form3Example3" style="margin-left: 0px;">Confirm
                                        Password</label>
                                    <div class="form-notch">
                                        <div class="form-notch-leading" style="width: 9px;"></div>
                                        <div class="form-notch-middle" style="width: 88.8px;"></div>
                                        <div class="form-notch-trailing"></div>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary btn-block mb-5">Update Password</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</body>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.2/mdb.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</html>
<script>
    // Function to display SweetAlert success message and redirect after a delay
    function showAlertAndRedirect() {
        Swal.fire({
            icon: 'success',
            title: 'Password updated successfully',
            showConfirmButton: false,
            timer: 5000 // 5 seconds
        }).then(() => {
            // Redirect to /login after 5 seconds
            window.location.href = '/';
        });
    }

    // Function to display SweetAlert error message
    function showErrorAlert(message) {
        Swal.fire({
            icon: 'error',
            title: 'Error updating password',
            text: message
        });
    }

    // Assuming you have a reference to the form element
    const form = document.querySelector('.sign-in-form');

    form.addEventListener('submit', function (event) {
        event.preventDefault(); // Prevent the default form submission

        // Your existing code to handle form submission
        const passwordInput = document.getElementById('password');
        const cpasswordInput = document.getElementById('cpassword');
        const passwordRegex = /^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[*.!@$%^&(){}[\]:;<>,.?/~_+\-=|\\]).{8,32}$/;

        // Check if passwords match
        if (passwordInput.value !== cpasswordInput.value) {
            showErrorAlert('Passwords do not match. Please try again.');
            return; // Stop further execution
        }

        // Check if password meets regex criteria
        if (!passwordRegex.test(passwordInput.value)) {
            showErrorAlert('Password must contain at least one digit, one lowercase and one uppercase letter, one special character, and be between 8 and 32 characters long.');
            return; // Stop further execution
        }

        const formData = new FormData(form);

        fetch('/update_password', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            // Check the response from the server
            if (data.success) {
                showAlertAndRedirect();
            } else {
                // Handle error if needed
                console.error('Error updating password:', data.error);
                showErrorAlert('Error updating password. Please try again later.');
            }
        })
        .catch(error => {
            console.error('Fetch error:', error);
            showErrorAlert('Something went wrong. Please try again later.');
        });
    });
</script>

